<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Анатомия Сети: Интерактивная Лекция</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            black: '#050505',
                            dark: '#121212',
                            gray: '#1a1a1a',
                            light: '#e0e0e0',
                            neon: '#deff9a',
                            alert: '#ff6b6b',
                            dim: '#bbbbbb',
                            blue: '#4cc9f0'
                        }
                    },
                    fontFamily: {
                        sans: ['Urbanist', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        /* Base Reset */
        body { 
            background-color: #050505; 
            color: #e0e0e0; 
            overflow: hidden; /* Prevent body scroll, handle per slide */
            touch-action: pan-y; /* Allow vertical scroll/swipe */
        }

        /* Hide Scrollbar but allow scroll */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .slide {
            height: 100vh;
            width: 100vw;
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* Align top for scrollable content */
            align-items: center;
            padding: 1.5rem; /* Reduced padding for mobile */
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            opacity: 0;
            pointer-events: none;
            z-index: 0;
            background-color: #050505;
            overflow-y: auto; /* Allow internal scrolling */
            overflow-x: hidden;
        }

        /* Desktop centering adjustment */
        @media (min-width: 768px) {
            .slide {
                justify-content: center;
                padding: 2rem;
            }
        }

        .slide.active { opacity: 1; pointer-events: auto; z-index: 10; transform: translateY(0); }
        .slide.prev { opacity: 0; transform: translateY(-100vh); pointer-events: none; }
        .slide.next { opacity: 0; transform: translateY(100vh); pointer-events: none; }

        .chart-container { position: relative; width: 100%; height: 250px; margin: 0 auto; }
        @media (min-width: 768px) { .chart-container { height: 300px; max-width: 600px; } }

        .nav-btn { backdrop-filter: blur(5px); transition: all 0.3s ease; cursor: pointer; }
        .nav-btn:hover { background-color: rgba(222, 255, 154, 0.2); color: #deff9a; }
        
        /* Slide Number Style */
        .slide-number {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            color: #444;
            pointer-events: none;
            z-index: 20;
        }
        .slide.active .slide-number {
            color: #deff9a;
            transition: color 1s ease;
        }
        @media (min-width: 768px) { .slide-number { bottom: 2rem; left: 2rem; font-size: 1.5rem; } }

        /* Specific OSI Styles */
        .osi-card {
            transition: all 0.3s ease;
        }
        .osi-btn {
            cursor: pointer;
            white-space: nowrap; /* Prevent text wrap in horizontal scroll */
        }
        
        /* Mobile horizontal scroll for OSI buttons */
        .osi-nav-container {
            -webkit-overflow-scrolling: touch;
        }
    </style>
</head>
<body class="bg-cyber-black text-cyber-light font-sans selection:bg-cyber-neon selection:text-cyber-black">

    <!-- Navigation Overlay (Fixed) -->
    <div class="fixed bottom-4 right-4 z-50 flex gap-3 md:bottom-8 md:right-8 md:gap-4">
        <button onclick="changeSlide(-1)" class="nav-btn w-10 h-10 md:w-12 md:h-12 rounded-full border border-cyber-neon/30 text-cyber-neon flex items-center justify-center active:scale-95 md:hover:scale-110 bg-black/50" title="Вверх/Назад">
            <i class="fa-solid fa-arrow-up"></i>
        </button>
        <button onclick="changeSlide(1)" class="nav-btn w-10 h-10 md:w-12 md:h-12 rounded-full border border-cyber-neon/30 text-cyber-neon flex items-center justify-center active:scale-95 md:hover:scale-110 bg-black/50" title="Вниз/Далее">
            <i class="fa-solid fa-arrow-down"></i>
        </button>
    </div>

    <!-- Progress Bar (Top) -->
    <div class="fixed top-0 left-0 w-full h-1 bg-cyber-gray z-50">
        <div id="progress-bar" class="h-full bg-cyber-neon transition-all duration-300" style="width: 0%"></div>
    </div>

    <!-- Slide Number Indicator -->
    <div class="slide-number z-50"><span id="current-slide-num">00</span> / 04</div>

    <!-- ================= SLIDES ================= -->

    <!-- SLIDE 0: Title -->
    <section class="slide active bg-cyber-black no-scrollbar" id="slide-0">
        <div class="absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-cyber-neon/20 via-transparent to-transparent pointer-events-none"></div>
        <div class="z-10 text-center w-full max-w-4xl flex flex-col justify-center min-h-full">
            <div class="mb-4 md:mb-6 inline-block px-3 py-1 border border-cyber-neon rounded-full text-cyber-neon text-xs md:text-sm uppercase tracking-widest self-center">
                Лекция / Семинар
            </div>
            <h1 class="text-4xl md:text-6xl lg:text-8xl font-bold mb-4 md:mb-6 leading-tight">
                Анатомия <span class="text-cyber-neon">Сети</span>
            </h1>
            <p class="text-lg md:text-2xl text-cyber-dim mb-8 md:mb-12 px-4">
                Как работает интернет, где живут уязвимости, и как государство контролирует трафик.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 text-left w-full px-2">
                <div class="p-4 border border-white/10 rounded-lg bg-white/5 backdrop-blur-sm">
                    <i class="fa-solid fa-layer-group text-cyber-neon text-xl md:text-2xl mb-2"></i>
                    <h3 class="font-bold text-base md:text-lg">База (OSI)</h3>
                    <p class="text-xs md:text-sm text-gray-400">От кабеля до браузера</p>
                </div>
                <div class="p-4 border border-white/10 rounded-lg bg-white/5 backdrop-blur-sm">
                    <i class="fa-solid fa-user-secret text-cyber-alert text-xl md:text-2xl mb-2"></i>
                    <h3 class="font-bold text-base md:text-lg">Угрозы</h3>
                    <p class="text-xs md:text-sm text-gray-400">Wi-Fi, 2G, СОРМ</p>
                </div>
                <div class="p-4 border border-white/10 rounded-lg bg-white/5 backdrop-blur-sm">
                    <i class="fa-solid fa-ban text-cyber-alert text-xl md:text-2xl mb-2"></i>
                    <h3 class="font-bold text-base md:text-lg">Цензура</h3>
                    <p class="text-xs md:text-sm text-gray-400">ТСПУ и замедление</p>
                </div>
            </div>
            <p class="mt-8 md:mt-12 text-xs md:text-sm text-gray-500 font-mono animate-pulse">Свайп вверх или нажми ↓</p>
        </div>
    </section>

    <!-- SLIDE 1: OSI Model Interactive -->
    <section class="slide bg-cyber-dark no-scrollbar" id="slide-1">
        <div class="w-full max-w-7xl flex flex-col h-full pt-4 md:justify-center">
            <h2 class="text-2xl md:text-4xl font-bold mb-4 md:mb-8 text-cyber-neon border-l-4 border-cyber-neon pl-4 shrink-0">
                Модель OSI
            </h2>
            
            <div class="flex flex-col md:grid md:grid-cols-12 gap-4 md:gap-6 h-full md:h-[75vh]">
                <!-- Layer Navigation (Horizontal Scroll on Mobile, Vertical on Desktop) -->
                <div class="md:col-span-3 flex md:flex-col-reverse gap-2 overflow-x-auto md:overflow-x-hidden md:overflow-y-auto pb-2 md:pb-0 osi-nav-container shrink-0 no-scrollbar">
                    <button onclick="setOsiLayer(1)" id="osi-btn-1" class="osi-btn p-2 md:p-3 border border-white/20 rounded hover:bg-white/10 text-left transition-all flex justify-between items-center group min-w-[140px] md:min-w-0">
                        <span class="font-mono font-bold text-sm md:text-lg">1. Физический</span>
                        <i class="fa-solid fa-network-wired opacity-50 group-hover:opacity-100 hidden md:block"></i>
                    </button>
                    <button onclick="setOsiLayer(2)" id="osi-btn-2" class="osi-btn p-2 md:p-3 border border-white/20 rounded hover:bg-white/10 text-left transition-all flex justify-between items-center group min-w-[140px] md:min-w-0">
                        <span class="font-mono font-bold text-sm md:text-lg">2. Канальный</span>
                        <i class="fa-solid fa-ethernet opacity-50 group-hover:opacity-100 hidden md:block"></i>
                    </button>
                    <button onclick="setOsiLayer(3)" id="osi-btn-3" class="osi-btn p-2 md:p-3 border border-white/20 rounded hover:bg-white/10 text-left transition-all flex justify-between items-center group min-w-[140px] md:min-w-0">
                        <span class="font-mono font-bold text-sm md:text-lg">3. Сетевой</span>
                        <i class="fa-solid fa-globe opacity-50 group-hover:opacity-100 hidden md:block"></i>
                    </button>
                    <button onclick="setOsiLayer(4)" id="osi-btn-4" class="osi-btn p-2 md:p-3 border border-white/20 rounded hover:bg-white/10 text-left transition-all flex justify-between items-center group min-w-[140px] md:min-w-0">
                        <span class="font-mono font-bold text-sm md:text-lg">4. Транспортный</span>
                        <i class="fa-solid fa-truck-fast opacity-50 group-hover:opacity-100 hidden md:block"></i>
                    </button>
                    <button onclick="setOsiLayer(5)" id="osi-btn-5" class="osi-btn p-2 md:p-3 border border-white/20 rounded hover:bg-white/10 text-left transition-all flex justify-between items-center group min-w-[140px] md:min-w-0">
                        <span class="font-mono font-bold text-sm md:text-lg">5. Сеансовый</span>
                        <i class="fa-solid fa-handshake opacity-50 group-hover:opacity-100 hidden md:block"></i>
                    </button>
                    <button onclick="setOsiLayer(6)" id="osi-btn-6" class="osi-btn p-2 md:p-3 border border-white/20 rounded hover:bg-white/10 text-left transition-all flex justify-between items-center group min-w-[140px] md:min-w-0">
                        <span class="font-mono font-bold text-sm md:text-lg">6. Представительский</span>
                        <i class="fa-solid fa-language opacity-50 group-hover:opacity-100 hidden md:block"></i>
                    </button>
                    <button onclick="setOsiLayer(7)" id="osi-btn-7" class="osi-btn p-2 md:p-3 border border-white/20 rounded hover:bg-white/10 text-left transition-all flex justify-between items-center group min-w-[140px] md:min-w-0">
                        <span class="font-mono font-bold text-sm md:text-lg">7. Прикладной</span>
                        <i class="fa-brands fa-chrome opacity-50 group-hover:opacity-100 hidden md:block"></i>
                    </button>
                </div>

                <!-- Info Panel -->
                <div class="md:col-span-9 bg-cyber-gray border border-white/10 rounded-xl p-4 md:p-6 flex flex-col relative overflow-hidden h-full">
                    <div class="absolute top-0 right-0 p-4 opacity-10">
                        <i id="osi-big-icon" class="fa-solid fa-network-wired text-6xl md:text-9xl"></i>
                    </div>
                    
                    <!-- Header -->
                    <div class="mb-4 md:mb-6 relative z-10 shrink-0">
                        <div class="flex items-end gap-2 md:gap-4">
                            <span id="osi-layer-num" class="text-4xl md:text-5xl font-bold text-cyber-neon font-mono leading-none">L1</span>
                            <div>
                                <h3 id="osi-title" class="text-xl md:text-3xl font-bold text-white leading-tight">Physical</h3>
                                <p id="osi-desc" class="text-white mt-1 text-sm md:text-lg text-gray-300">Среда передачи.</p>
                            </div>
                        </div>
                        <div class="mt-2 inline-block bg-black/40 px-2 py-1 rounded border border-white/10">
                             <span class="text-gray-400 font-mono text-xs md:text-sm">Тех: <span id="osi-tech" class="text-cyber-blue font-bold">Wi-Fi</span></span>
                        </div>
                    </div>

                    <!-- Scrollable Content Area -->
                    <div class="overflow-y-auto pr-2 custom-scroll flex-grow">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 relative z-10 pb-4">
                            <!-- Analogy -->
                            <div class="osi-card bg-black/30 p-4 rounded-lg border border-white/5 flex flex-col">
                                <h4 class="text-cyber-neon font-bold mb-2 flex items-center gap-2 border-b border-white/10 pb-2 text-sm md:text-base">
                                    <i class="fa-solid fa-envelope"></i> Аналогия (Почта)
                                </h4>
                                <p id="osi-analogy" class="text-gray-200 text-sm md:text-lg leading-relaxed">
                                    Грузовик.
                                </p>
                            </div>
                            
                            <!-- Threats -->
                            <div class="osi-card bg-black/30 p-4 rounded-lg border border-white/5 flex flex-col">
                                <h4 class="text-cyber-alert font-bold mb-2 flex items-center gap-2 border-b border-white/10 pb-2 text-sm md:text-base">
                                    <i class="fa-solid fa-triangle-exclamation"></i> Уязвимости
                                </h4>
                                
                                <div class="mb-3">
                                    <p class="text-[10px] md:text-xs text-gray-500 uppercase tracking-widest mb-1">Аналог угрозы</p>
                                    <p id="osi-threat-analogy" class="text-white text-sm italic bg-cyber-alert/10 p-2 rounded border-l-2 border-cyber-alert">
                                        Взрыв моста.
                                    </p>
                                </div>

                                <div>
                                    <p class="text-[10px] md:text-xs text-gray-500 uppercase tracking-widest mb-1">Атаки</p>
                                    <ul id="osi-threats" class="list-disc pl-5 space-y-1 text-gray-300 text-xs md:text-sm">
                                        <li>Обрыв кабеля</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SLIDE 2: Wireless Threats -->
    <section class="slide bg-cyber-black no-scrollbar" id="slide-2">
        <div class="w-full max-w-6xl pt-8 pb-16">
            <h2 class="text-2xl md:text-4xl font-bold mb-6 text-cyber-neon border-l-4 border-cyber-neon pl-4">Беспроводные Угрозы</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-12">
                <!-- 2G/Mobile -->
                <div class="bg-cyber-gray p-5 md:p-8 rounded-xl border border-white/10">
                    <div class="flex items-center gap-4 mb-4 md:mb-6">
                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-cyber-alert/20 flex items-center justify-center text-cyber-alert text-xl md:text-2xl shrink-0">
                            <i class="fa-solid fa-tower-cell"></i>
                        </div>
                        <h3 class="text-xl md:text-2xl font-bold">2G / GSM</h3>
                    </div>
                    <ul class="space-y-3 md:space-y-4">
                        <li class="bg-black/40 p-3 md:p-4 rounded border-l-2 border-cyber-alert">
                            <strong class="text-white block mb-1 text-sm md:text-base">Downgrade Attack</strong>
                            <span class="text-xs md:text-sm text-gray-400">Сброс с LTE на 2G, где нет шифрования.</span>
                        </li>
                        <li class="bg-black/40 p-3 md:p-4 rounded border-l-2 border-cyber-alert">
                            <strong class="text-white block mb-1 text-sm md:text-base">IMSI Catcher</strong>
                            <span class="text-xs md:text-sm text-gray-400">Ложная вышка перехватывает трафик.</span>
                        </li>
                    </ul>
                </div>

                <!-- Wi-Fi -->
                <div class="bg-cyber-gray p-5 md:p-8 rounded-xl border border-white/10">
                    <div class="flex items-center gap-4 mb-4 md:mb-6">
                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-yellow-500/20 flex items-center justify-center text-yellow-500 text-xl md:text-2xl shrink-0">
                            <i class="fa-solid fa-wifi"></i>
                        </div>
                        <h3 class="text-xl md:text-2xl font-bold">Wi-Fi (MitM)</h3>
                    </div>
                    
                    <div class="space-y-4 md:space-y-6">
                        <div class="relative bg-black/50 p-4 md:p-6 rounded-lg border border-yellow-500/30">
                            <h4 class="font-bold text-base md:text-lg mb-2">Man-in-the-Middle</h4>
                            <p class="text-xs md:text-sm text-gray-400 mb-3">
                                Хакерская точка "Free_Wifi". Трафик идет через злоумышленника.
                            </p>
                            <div class="flex justify-between items-center text-[10px] md:text-xs font-mono text-gray-500 bg-black p-2 rounded">
                                <span>Вы</span>
                                <i class="fa-solid fa-arrow-right text-red-500 animate-pulse"></i>
                                <span class="text-red-500">Хакер</span>
                                <i class="fa-solid fa-arrow-right text-red-500 animate-pulse"></i>
                                <span>Сайт</span>
                            </div>
                        </div>
                        
                        <div class="bg-black/40 p-3 md:p-4 rounded border-l-2 border-yellow-500">
                             <strong class="text-white block mb-1 text-sm">Совет:</strong>
                             <span class="text-xs md:text-sm text-gray-400">В кафе всегда включайте VPN.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SLIDE 3: SORM & Censorship -->
    <section class="slide bg-cyber-dark no-scrollbar" id="slide-3">
        <div class="w-full max-w-6xl pt-8 pb-16">
            <h2 class="text-2xl md:text-4xl font-bold mb-6 text-cyber-neon border-l-4 border-cyber-neon pl-4">Госслежка (СОРМ)</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-12 gap-6 md:gap-8">
                <!-- Text Content -->
                <div class="md:col-span-7 space-y-4 md:space-y-6">
                    <div class="bg-cyber-gray p-5 md:p-6 rounded-xl border border-white/10">
                        <h3 class="text-lg md:text-xl font-bold text-white mb-2 flex items-center gap-2">
                            <i class="fa-solid fa-server text-blue-400"></i> СОРМ
                        </h3>
                        <p class="text-gray-400 text-xs md:text-sm mb-4">
                            "Черный ящик" у провайдера, копирующий трафик для ФСБ.
                        </p>
                        <div class="grid grid-cols-2 gap-2 text-xs md:text-sm">
                            <div class="bg-black/30 p-2 rounded"><span class="text-blue-400 font-bold">СОРМ-1:</span> Звонки</div>
                            <div class="bg-black/30 p-2 rounded"><span class="text-blue-400 font-bold">СОРМ-2:</span> Интернет</div>
                        </div>
                    </div>

                    <div class="bg-cyber-gray p-5 md:p-6 rounded-xl border border-white/10">
                        <h3 class="text-lg md:text-xl font-bold text-white mb-2 flex items-center gap-2">
                            <i class="fa-solid fa-microchip text-red-500"></i> ТСПУ (РКН)
                        </h3>
                        <p class="text-gray-400 text-xs md:text-sm mb-3">
                            Оборудование для блокировок и замедления (DPI).
                        </p>
                        <ul class="space-y-1 text-xs md:text-sm text-gray-300">
                            <li><i class="fa-solid fa-ban text-red-500 w-4"></i> Замедление YouTube</li>
                            <li><i class="fa-solid fa-phone-slash text-red-500 w-4"></i> Блок звонков WhatsApp</li>
                        </ul>
                    </div>
                </div>

                <!-- Visualization -->
                <div class="md:col-span-5 flex flex-col items-center justify-center bg-cyber-gray p-4 md:p-6 rounded-xl border border-white/10">
                    <h4 class="mb-4 font-bold text-gray-300 text-sm md:text-base">Замедление (Throttling)</h4>
                    <div class="chart-container">
                        <canvas id="censorshipChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SLIDE 4: Digital Hygiene & Conclusion -->
    <section class="slide bg-cyber-dark no-scrollbar" id="slide-4">
        <div class="w-full max-w-5xl pt-8 pb-16">
            <h2 class="text-2xl md:text-4xl font-bold mb-6 text-cyber-neon border-l-4 border-cyber-neon pl-4">Цифровая Гигиена</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                <div class="space-y-3 md:space-y-4">
                    <div class="bg-cyber-gray p-4 md:p-5 rounded-lg flex items-start gap-3 md:gap-4">
                        <i class="fa-solid fa-lock text-cyber-neon text-lg md:text-xl mt-1"></i>
                        <div>
                            <h4 class="font-bold text-white text-sm md:text-base">DNS over HTTPS</h4>
                            <p class="text-xs md:text-sm text-gray-400">Скрывает список сайтов от провайдера.</p>
                        </div>
                    </div>
                    
                    <div class="bg-cyber-gray p-4 md:p-5 rounded-lg flex items-start gap-3 md:gap-4">
                        <i class="fa-solid fa-shield-halved text-cyber-neon text-lg md:text-xl mt-1"></i>
                        <div>
                            <h4 class="font-bold text-white text-sm md:text-base">VPN</h4>
                            <p class="text-xs md:text-sm text-gray-400">Шифрует весь канал связи.</p>
                        </div>
                    </div>

                    <div class="bg-cyber-gray p-4 md:p-5 rounded-lg flex items-start gap-3 md:gap-4">
                        <i class="fa-brands fa-signal-messenger text-cyber-neon text-lg md:text-xl mt-1"></i>
                        <div>
                            <h4 class="font-bold text-white text-sm md:text-base">Secret Chats</h4>
                            <p class="text-xs md:text-sm text-gray-400">Только E2E шифрование защищает переписку.</p>
                        </div>
                    </div>
                </div>

                <div class="bg-black/30 p-6 md:p-8 rounded-xl border border-cyber-neon/30 flex flex-col justify-center items-center text-center mt-4 md:mt-0">
                    <i class="fa-regular fa-circle-question text-4xl md:text-6xl text-cyber-dim mb-4 md:mb-6"></i>
                    <h3 class="text-2xl md:text-3xl font-bold text-white mb-2 md:mb-4">Вопросы?</h3>
                    <p class="text-gray-400 mb-6 md:mb-8 text-sm md:text-base">
                        Безопасность — это процесс.
                    </p>
                    <button onclick="currentSlide = 0; updateSlides();" class="px-5 py-2 md:px-6 md:py-2 bg-cyber-neon text-cyber-black font-bold rounded hover:bg-white transition-colors text-sm md:text-base">
                        В начало
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- JavaScript Logic -->
    <script>
        // --- State Management ---
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const totalSlides = slides.length;
        const progressBar = document.getElementById('progress-bar');
        const numIndicator = document.getElementById('current-slide-num');

        // --- Navigation Logic ---
        function updateSlides() {
            slides.forEach((slide, index) => {
                slide.classList.remove('active', 'prev', 'next');
                if (index === currentSlide) {
                    slide.classList.add('active');
                } else if (index < currentSlide) {
                    slide.classList.add('prev');
                } else {
                    slide.classList.add('next');
                }
            });
            
            // Update UI
            const progress = ((currentSlide) / (totalSlides - 1)) * 100;
            progressBar.style.width = `${progress}%`;
            numIndicator.innerText = String(currentSlide).padStart(2, '0');
        }

        function changeSlide(direction) {
            const newIndex = currentSlide + direction;
            if (newIndex >= 0 && newIndex < totalSlides) {
                currentSlide = newIndex;
                updateSlides();
            }
        }

        // Keyboard Controls
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowDown' || e.key === 'ArrowRight' || e.code === 'Space') {
                changeSlide(1);
            } else if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
                changeSlide(-1);
            }
        });

        // --- Touch/Swipe Support ---
        let touchStartY = 0;
        let touchEndY = 0;
        const minSwipeDistance = 50;

        document.addEventListener('touchstart', (e) => {
            touchStartY = e.changedTouches[0].screenY;
        }, {passive: true});

        document.addEventListener('touchend', (e) => {
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe(e.target);
        }, {passive: true});

        function handleSwipe(target) {
            const distance = touchStartY - touchEndY;
            
            // Check if user is scrolling inside a scrollable element
            let scrollableParent = target.closest('.overflow-y-auto');
            if (scrollableParent) {
                // If scrollable and not at boundaries, don't change slide
                const isAtTop = scrollableParent.scrollTop === 0;
                const isAtBottom = Math.abs(scrollableParent.scrollHeight - scrollableParent.scrollTop - scrollableParent.clientHeight) < 1;

                if (distance > 0 && !isAtBottom) return; // Swiping up, but content can scroll down
                if (distance < 0 && !isAtTop) return;   // Swiping down, but content can scroll up
            }

            if (Math.abs(distance) > minSwipeDistance) {
                if (distance > 0) {
                    changeSlide(1); // Swipe Up -> Next
                } else {
                    changeSlide(-1); // Swipe Down -> Prev
                }
            }
        }

        // Initialize First Slide
        updateSlides();


        // --- OSI Interactive Model Logic ---
        const osiData = {
            1: {
                title: "Физический",
                desc: "Среда передачи (Биты).",
                tech: "Витая пара, Оптоволокно, Wi-Fi",
                pdu: "Бит (Bit)",
                hw: "Кабель, Hub",
                analogy: "Дорога и грузовик. Если дорога разбита, груз не поедет.",
                threats: ["Обрыв кабеля", "Глушилки", "ЭМИ"],
                threat_analogy: "Взрыв моста или угон грузовика."
            },
            2: {
                title: "Канальный",
                desc: "Адресация в одной сети.",
                tech: "Ethernet, MAC",
                pdu: "Кадр (Frame)",
                hw: "Switch (Коммутатор)",
                analogy: "Сортировка внутри офиса по номерам кабинетов.",
                threats: ["MAC Spoofing", "ARP Poisoning"],
                threat_analogy: "Мошенник с бейджем вашего коллеги."
            },
            3: {
                title: "Сетевой",
                desc: "Маршрутизация по миру.",
                tech: "IP, ICMP, IPsec",
                pdu: "Пакет",
                hw: "Роутер",
                analogy: "Глобальная почта. Индекс и адрес на конверте.",
                threats: ["IP Spoofing", "MitM"],
                threat_analogy: "Подмена дорожных знаков, грузовик уехал не туда."
            },
            4: {
                title: "Транспортный",
                desc: "Надежность и порты.",
                tech: "TCP, UDP",
                pdu: "Сегмент",
                hw: "Firewall",
                analogy: "Тип письма: заказное (TCP) или открытка (UDP). Порт - имя получателя.",
                threats: ["Сканирование портов", "DDoS"],
                threat_analogy: "Почтовый ящик забили спамом."
            },
            5: {
                title: "Сеансовый",
                desc: "Диалог устройств.",
                tech: "Sockets, RPC",
                pdu: "Данные",
                hw: "Шлюз",
                analogy: "Секретарь соединяет звонок: 'Алло, вы на связи?'.",
                threats: ["Session Hijacking"],
                threat_analogy: "Кто-то перехватил трубку параллельного телефона."
            },
            6: {
                title: "Представления",
                desc: "Формат и шифрование.",
                tech: "SSL/TLS, JPEG",
                pdu: "Данные",
                hw: "Шлюз",
                analogy: "Переводчик и упаковка в непрозрачный конверт.",
                threats: ["SSL Stripping"],
                threat_analogy: "Письмо вскрыли паром и прочитали."
            },
            7: {
                title: "Прикладной",
                desc: "Интерфейс.",
                tech: "HTTP, DNS",
                pdu: "Данные",
                hw: "Браузер",
                analogy: "Смысл письма. То, что видит пользователь.",
                threats: ["Фишинг", "SQL-инъекции"],
                threat_analogy: "В письме просьба срочно перевести деньги мошеннику."
            }
        };

        function setOsiLayer(layerNum) {
            // UI Update
            document.querySelectorAll('.osi-btn').forEach(btn => {
                btn.classList.remove('bg-cyber-neon/20', 'border-cyber-neon');
                btn.classList.add('border-white/20');
            });
            const activeBtn = document.getElementById(`osi-btn-${layerNum}`);
            activeBtn.classList.remove('border-white/20');
            activeBtn.classList.add('bg-cyber-neon/20', 'border-cyber-neon');

            // Content Update
            const data = osiData[layerNum];
            document.getElementById('osi-layer-num').innerText = `L${layerNum}`;
            document.getElementById('osi-title').innerText = data.title;
            document.getElementById('osi-desc').innerText = data.desc;
            document.getElementById('osi-tech').innerText = data.tech;
            
            document.getElementById('osi-analogy').innerText = data.analogy;
            document.getElementById('osi-threat-analogy').innerText = data.threat_analogy;
            
            // Threats Update
            const threatsList = document.getElementById('osi-threats');
            threatsList.innerHTML = '';
            data.threats.forEach(threat => {
                const li = document.createElement('li');
                li.innerText = threat;
                threatsList.appendChild(li);
            });
        }
        
        // Init OSI Layer 1
        setOsiLayer(7);


        // --- Chart.js Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('censorshipChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['00:00', '00:10', '00:20', '00:30', '00:40', '00:50', '01:00'],
                    datasets: [
                        {
                            label: 'Обычный',
                            data: [100, 98, 100, 102, 99, 100, 101],
                            borderColor: '#888888',
                            borderDash: [5, 5],
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: 'Замедление',
                            data: [100, 95, 45, 30, 25, 30, 28], // Drop representing DPI intervention
                            borderColor: '#ff6b6b',
                            backgroundColor: 'rgba(255, 107, 107, 0.1)',
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#e0e0e0', font: {size: 10} } },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#bbbbbb', font: {size: 9}, callback: function(value) { return value + ' Mb'; } }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#bbbbbb', font: {size: 9} }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        });
    </script>
</body>
</html>
